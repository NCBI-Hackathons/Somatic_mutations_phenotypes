---
title: "Analyze TCGA data for SKCM cohort"
author: "Jacqueline Buros & ... "
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

Here we are demonstrating the feasibility of analyzing genomic data using Stan. The first use case is to analyze somatic mutations for association with survival, after adjusting for key clinical variables with known prognostic status.

```{r setup, include = F, warnings = F, echo = F}
# library(SuMu)
library(dplyr)
library(survminer)
library(survival)
library(ggplot2)
library(scales)
```

## Clinical Data

First, download the clinical data. Here we are using the TCGA skin cutaneous melanoma (SKCM) cohort.

```{r load-clin}
clin_df <- SuMu::get_tcga_clinical(cohort = "SKCM")
```

### Review clinical data 

For this analysis we will consider the survival time in `r print(unique(clin_df$_OS_UNIT))` since initial pathologic diagnosis.

```{r plot-survival}
fit <- survfit(Surv(OS, OS_IND) ~ 1,
                  data = clin_df)
survminer::ggsurvplot(fit) + 
  ggtitle('Survival since diagnosis in full cohort')
```

Plotting by stage, although the time of 'stage' determination may be confounded if not collected at time of initial diagnosis.

```{r plot-survival-by-stage}
fit <- survfit(Surv(OS, OS_IND) ~ pathologic_stage,
                  data = clin_df)
survminer::ggsurvplot(fit, legend = "right")
```

There also seem to be differences by tumor type.

```{r plot-survival-by-sample-type}
fit <- survfit(Surv(`_OS`, `_OS_IND`) ~ sample_type,
                  data = clin_df)
survminer::ggsurvplot(fit, legend = "right")
```

## Somatic Mutations Data

We can download the somatic mutations to supplement the phenotypes.

```{r load-mut}
mut_df <- SuMu::get_tcga_somatic_mutations(cohort = "SKCM")
```

Check the most frequent mutations.

```{r check-top-muts}
mut_df$gene_aa = paste0(mut_df$gene, ":", mut_df$Amino_Acid_Change)
mut_df %>% filter(effect == "Missense_Mutation") %>% select(gene_aa) %>% table %>% sort %>% rev %>% as.data.frame %>% head(10)
```
